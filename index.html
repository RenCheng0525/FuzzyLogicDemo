<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuzzy Logic Mathematics Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --primary: #4285F4;
            --secondary: #DB4437;
            --tertiary: #0F9D58;
            --accent: #F4B400;
            --light-bg: #f5f7fa;
            --dark-text: #333;
            --light-text: #666;
            --border: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            background-color: var(--light-bg);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 2.2rem;
        }

        h2 {
            color: var(--dark-text);
            margin-bottom: 15px;
            font-size: 1.6rem;
        }

        h3 {
            color: var(--dark-text);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--light-text);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr 1fr;
            }

            .grid-3 {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 8px;
        }

        select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }

        .info-box {
            background-color: var(--light-bg);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .value-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--tertiary);
            text-align: center;
            margin: 10px 0;
        }

        .rule-card {
            background-color: #e8f0fe;
            border: 1px solid #c6d8f9;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .value-range {
            display: flex;
            justify-content: space-between;
            margin-top: 2px;
            font-size: 0.75rem;
            color: var(--light-text);
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--light-text);
            font-size: 0.85rem;
        }

        .formula {
            font-family: 'Courier New', monospace;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin: 10px 0;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .history-table th,
        .history-table td {
            border: 1px solid var(--border);
            padding: 8px 12px;
            text-align: left;
        }

        .history-table th {
            background-color: var(--light-bg);
            font-weight: 600;
        }

        .history-table tr:nth-child(even) {
            background-color: var(--light-bg);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-blue {
            background-color: #e8f0fe;
            color: var(--primary);
        }

        .badge-red {
            background-color: #fee8e7;
            color: var(--secondary);
        }

        .badge-green {
            background-color: #e6f4ea;
            color: var(--tertiary);
        }

        .function-list {
            list-style-type: none;
        }

        .function-list li {
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .function-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .definition-list {
            list-style-type: none;
            margin-left: 15px;
        }

        .definition-list li {
            margin-bottom: 5px;
            border: none;
            padding: 3px 0;
        }

        .text-center {
            text-align: center;
        }

        .mb-15 {
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Fuzzy Logic Mathematics Visualization</h1>

        <div class="tabs">
            <button class="tab active" data-tab="membership">Fuzzy Sets & Operations</button>
            <button class="tab" data-tab="inference">Fuzzy Inference System</button>
            <button class="tab" data-tab="history">Historical Trends</button>
        </div>

        <!-- Fuzzy Sets and Operations Tab -->
        <div id="membership" class="tab-content active">
            <div class="grid grid-2">
                <div class="card">
                    <h2>Fuzzy Set Parameters</h2>

                    <div class="mb-15">
                        <label for="membership-function">Membership Function Type:</label>
                        <select id="membership-function">
                            <option value="triangular">Triangular</option>
                            <option value="trapezoidal">Trapezoidal</option>
                            <option value="gaussian">Gaussian</option>
                            <option value="sigmoid">Sigmoid</option>
                            <option value="bell">Bell-shaped</option>
                        </select>
                    </div>

                    <h3>Set A Parameters</h3>
                    <div class="param-grid">
                        <div>
                            <label for="set1-a">Parameter a:</label>
                            <input type="range" id="set1-a" min="0" max="10" step="0.1" value="0">
                            <div id="set1-a-value" class="text-center">0.0</div>
                        </div>
                        <div>
                            <label for="set1-b">Parameter b:</label>
                            <input type="range" id="set1-b" min="0" max="10" step="0.1" value="4">
                            <div id="set1-b-value" class="text-center">4.0</div>
                        </div>
                        <div>
                            <label for="set1-c">Parameter c:</label>
                            <input type="range" id="set1-c" min="0" max="10" step="0.1" value="8">
                            <div id="set1-c-value" class="text-center">8.0</div>
                        </div>
                        <div id="set1-d-container" style="display:none">
                            <label for="set1-d">Parameter d:</label>
                            <input type="range" id="set1-d" min="0" max="10" step="0.1" value="0">
                            <div id="set1-d-value" class="text-center">0.0</div>
                        </div>
                    </div>

                    <h3>Set B Parameters</h3>
                    <div class="param-grid">
                        <div>
                            <label for="set2-a">Parameter a:</label>
                            <input type="range" id="set2-a" min="0" max="10" step="0.1" value="2">
                            <div id="set2-a-value" class="text-center">2.0</div>
                        </div>
                        <div>
                            <label for="set2-b">Parameter b:</label>
                            <input type="range" id="set2-b" min="0" max="10" step="0.1" value="6">
                            <div id="set2-b-value" class="text-center">6.0</div>
                        </div>
                        <div>
                            <label for="set2-c">Parameter c:</label>
                            <input type="range" id="set2-c" min="0" max="10" step="0.1" value="10">
                            <div id="set2-c-value" class="text-center">10.0</div>
                        </div>
                        <div id="set2-d-container" style="display:none">
                            <label for="set2-d">Parameter d:</label>
                            <input type="range" id="set2-d" min="0" max="10" step="0.1" value="0">
                            <div id="set2-d-value" class="text-center">0.0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Fuzzy Operations</h2>

                    <div>
                        <label for="operation">Fuzzy Operation:</label>
                        <select id="operation">
                            <option value="AND">Intersection (AND, Min)</option>
                            <option value="OR">Union (OR, Max)</option>
                            <option value="NOT">Complement (NOT)</option>
                            <option value="PLUS">Algebraic Sum</option>
                            <option value="MULT">Algebraic Product</option>
                            <option value="VERY">Concentration (VERY)</option>
                            <option value="SOMEWHAT">Dilation (SOMEWHAT)</option>
                        </select>
                    </div>

                    <div>
                        <label for="input-value">Input value x:</label>
                        <input type="range" id="input-value" min="0" max="10" step="0.1" value="5">
                        <div id="input-value-display" class="text-center">5.0</div>
                    </div>

                    <h3>Defuzzification</h3>
                    <div>
                        <label for="defuzzification">Method:</label>
                        <select id="defuzzification">
                            <option value="centroid">Centroid</option>
                            <option value="bisector">Bisector</option>
                            <option value="mean_of_maximum">Mean of Maximum (MOM)</option>
                            <option value="first_of_maximum">First of Maximum (FOM)</option>
                            <option value="last_of_maximum">Last of Maximum (LOM)</option>
                        </select>

                        <div>
                            <label>Defuzzification Result:</label>
                            <div id="defuzzified-value" class="value-display">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Fuzzy Set Visualization</h2>
                <div id="membership-chart" class="chart-container"></div>

                <div class="info-box">
                    <h3>Details</h3>
                    <p>
                        This chart displays two fuzzy sets A and B, and the result of fuzzy operations between them.
                        You can observe the membership degree μ(x) in each set by adjusting the input x value and see
                        the defuzzification result.
                    </p>
                    <ul style="list-style: none; margin-top: 10px;">
                        <li><span style="color: var(--primary); font-weight: bold;">Blue line</span>: Membership
                            function of Set A</li>
                        <li><span style="color: var(--secondary); font-weight: bold;">Red line</span>: Membership
                            function of Set B</li>
                        <li><span style="color: var(--tertiary); font-weight: bold;">Green line</span>: Fuzzy operation
                            result</li>
                        <li><span style="color: var(--accent); font-weight: bold;">Yellow marker</span>: Defuzzification
                            result</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h2>Fuzzy Operation Mathematical Formulas</h2>
                <div class="grid grid-2">
                    <div>
                        <h3>Common Membership Functions</h3>
                        <ul class="function-list">
                            <li>
                                <div class="function-name">Triangular:</div>
                                <div class="formula">
                                    μA(x) =
                                    <ul class="definition-list">
                                        <li>0, if x ≤ a or x ≥ c</li>
                                        <li>(x - a) / (b - a), if a &lt; x &lt; b</li>
                                        <li>(c - x) / (c - b), if b &lt; x &lt; c</li>
                                    </ul>
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Trapezoidal:</div>
                                <div class="formula">
                                    μA(x) =
                                    <ul class="definition-list">
                                        <li>0, if x ≤ a or x ≥ d</li>
                                        <li>(x - a) / (b - a), if a &lt; x &lt; b</li>
                                        <li>1, if b ≤ x ≤ c</li>
                                        <li>(d - x) / (d - c), if c &lt; x &lt; d</li>
                                    </ul>
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Gaussian:</div>
                                <div class="formula">
                                    μA(x) = exp(-0.5 * ((x - m) / σ)²)
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h3>Fuzzy Operations</h3>
                        <ul class="function-list">
                            <li>
                                <div class="function-name">Intersection (AND):</div>
                                <div class="formula">
                                    μA∩B(x) = min(μA(x), μB(x))
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Union (OR):</div>
                                <div class="formula">
                                    μA∪B(x) = max(μA(x), μB(x))
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Complement (NOT):</div>
                                <div class="formula">
                                    μĀ(x) = 1 - μA(x)
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Algebraic Product:</div>
                                <div class="formula">
                                    μA*B(x) = μA(x) * μB(x)
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Algebraic Sum:</div>
                                <div class="formula">
                                    μA+B(x) = μA(x) + μB(x) - μA(x) * μB(x)
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fuzzy Inference System Tab -->
        <div id="inference" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <h2>Input Variables</h2>

                    <div style="margin-bottom: 20px;">
                        <label for="inference-input1">Input 1 (x):</label>
                        <input type="range" id="inference-input1" min="0" max="10" step="0.1" value="5">
                        <div class="value-range">
                            <span>Low</span>
                            <span>Medium</span>
                            <span>High</span>
                        </div>
                        <div id="inference-input1-value" class="text-center">5.0</div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="inference-input2">Input 2 (y):</label>
                        <input type="range" id="inference-input2" min="0" max="10" step="0.1" value="7">
                        <div class="value-range">
                            <span>Low</span>
                            <span>Medium</span>
                            <span>High</span>
                        </div>
                        <div id="inference-input2-value" class="text-center">7.0</div>
                    </div>

                    <h3>Fuzzification Results</h3>
                    <div class="grid grid-2">
                        <div class="info-box">
                            <h4>Input 1 (x) Fuzzification:</h4>
                            <ul id="input1-fuzzification" style="list-style: none; margin-top: 5px;">
                                <li>Low: 0.00</li>
                                <li>Medium: 0.50</li>
                                <li>High: 0.00</li>
                            </ul>
                        </div>
                        <div class="info-box">
                            <h4>Input 2 (y) Fuzzification:</h4>
                            <ul id="input2-fuzzification" style="list-style: none; margin-top: 5px;">
                                <li>Low: 0.00</li>
                                <li>Medium: 0.00</li>
                                <li>High: 0.50</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Fuzzy Rules</h2>

                    <div id="rules-container">
                        <div class="rule-card">
                            <div class="rule-header">
                                <div>
                                    <span class="badge badge-blue">Rule 1</span>
                                    IF
                                    <select class="rule-condition" data-index="0">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                    AND
                                    <select class="rule-condition2" data-index="0">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                    THEN output is
                                    <select class="rule-output" data-index="0">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div>
                                    <input type="range" min="0" max="1" step="0.1" value="1.0" class="rule-weight"
                                        style="width: 60px;">
                                    <span class="rule-weight-value">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <button id="add-rule"
                        style="background-color: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-top: 10px; cursor: pointer; font-size: 0.85rem;">
                        + Add Rule
                    </button>

                    <h3 style="margin-top: 20px;">Inference Result</h3>
                    <div id="inference-result" class="value-display">0</div>

                    <div class="info-box">
                        <h4>Rule Activation Levels:</h4>
                        <ul id="rule-firing-strengths" style="list-style: none; margin-top: 5px;">
                            <li
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span>Rule 1:</span>
                                <div style="width: 120px; margin: 0 5px;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 50%;"></div>
                                    </div>
                                </div>
                                <span>0.50</span>
                            </li>
                            <li
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span>Rule 2:</span>
                                <div style="width: 120px; margin: 0 5px;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 40%;"></div>
                                    </div>
                                </div>
                                <span>0.40</span>
                            </li>
                            <li style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Rule 3:</span>
                                <div style="width: 120px; margin: 0 5px;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 0%;"></div>
                                    </div>
                                </div>
                                <span>0.00</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Inference Process Visualization</h2>
                <div id="inference-chart" class="chart-container"></div>

                <div class="info-box">
                    <h3>Mamdani Fuzzy Inference Process</h3>
                    <ol style="margin-left: 20px;">
                        <li>
                            <span style="font-weight: 600;">Fuzzification</span>:
                            Convert precise input values into fuzzy membership degrees
                        </li>
                        <li>
                            <span style="font-weight: 600;">Rule Evaluation</span>:
                            Apply fuzzy operations to calculate the activation level of each rule
                        </li>
                        <li>
                            <span style="font-weight: 600;">Aggregation</span>:
                            Combine the results of all rules into a single fuzzy output set
                        </li>
                        <li>
                            <span style="font-weight: 600;">Defuzzification</span>:
                            Calculate a precise numerical value from the fuzzy output set, typically using the centroid
                            method
                        </li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <h2>Fuzzy Inference Applications</h2>
                <div class="grid grid-3">
                    <div style="border: 1px solid var(--border); border-radius: 6px; padding: 15px;">
                        <h3>Control Systems</h3>
                        <ul style="margin-left: 20px;">
                            <li>Temperature control</li>
                            <li>Autonomous driving</li>
                            <li>Robot navigation</li>
                            <li>Image stabilization</li>
                        </ul>
                    </div>
                    <div style="border: 1px solid var(--border); border-radius: 6px; padding: 15px;">
                        <h3>Decision Support</h3>
                        <ul style="margin-left: 20px;">
                            <li>Risk assessment</li>
                            <li>Medical diagnostics</li>
                            <li>Financial analysis</li>
                            <li>Resource allocation</li>
                        </ul>
                    </div>
                    <div style="border: 1px solid var(--border); border-radius: 6px; padding: 15px;">
                        <h3>Pattern Recognition</h3>
                        <ul style="margin-left: 20px;">
                            <li>Image recognition</li>
                            <li>Speech processing</li>
                            <li>Data clustering</li>
                            <li>Anomaly detection</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historical Trends Tab -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2>Defuzzification Results History</h2>
                <div id="history-chart" class="chart-container"></div>

                <div>
                    <h3>Historical Data</h3>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Defuzzified Value</th>
                                    <th>Operation</th>
                                    <th>Defuzzification Method</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                                <!-- Historical data will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Defuzzification Methods Comparison</h2>

                <div class="grid grid-2">
                    <div>
                        <h3>Common Defuzzification Methods</h3>
                        <ul class="function-list">
                            <li>
                                <div class="function-name">Centroid Method:</div>
                                <p>Calculates the geometric center of the fuzzy set shape. Most commonly used and
                                    accurate method.</p>
                                <div class="formula">
                                    z* = ∫μ(z)·z dz / ∫μ(z) dz
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Bisector Method:</div>
                                <p>Finds the vertical line that divides the fuzzy set area into two equal parts.</p>
                                <div class="formula">
                                    ∫<sub>a</sub><sup>z*</sup>μ(z) dz = ∫<sub>z*</sub><sup>b</sup>μ(z) dz
                                </div>
                            </li>
                            <li>
                                <div class="function-name">Mean of Maximum Method:</div>
                                <p>Calculates the average of all points with maximum membership degree.</p>
                                <div class="formula">
                                    z* = ∑z<sub>j</sub> / M, where μ(z<sub>j</sub>) = max
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h3>Method Pros and Cons</h3>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Advantages</th>
                                    <th>Disadvantages</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Centroid</td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>Considers entire shape</li>
                                            <li>Smooth changes in results</li>
                                            <li>Intuitive calculation</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>High computational complexity</li>
                                            <li>Slow for complex shapes</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Bisector</td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>Considers overall distribution</li>
                                            <li>Good symmetry properties</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>Less accurate for multi-peak distributions</li>
                                            <li>Relatively complex calculation</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Mean of Maximum</td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>Simple and fast calculation</li>
                                            <li>Suitable for multi-peak distributions</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul style="margin-left: 15px;">
                                            <li>Only considers maximum value points</li>
                                            <li>Ignores most shape information</li>
                                        </ul>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Fuzzy Logic Mathematics Visualization System © 2025</p>
            <p style="margin-top: 5px;">
                Supports triangular, trapezoidal, Gaussian and other membership functions, AND/OR/NOT fuzzy operations,
                and rule-based fuzzy inference systems
            </p>
        </div>
    </div>

    <script>
        // Initialize global variables
        let fuzzySet1Params = { a: 0, b: 4, c: 8, d: 0 };
        let fuzzySet2Params = { a: 2, b: 6, c: 10, d: 0 };
        let selectedMembershipFunction = 'triangular';
        let selectedOperation = 'AND';
        let inputValue = 5;
        let defuzzificationMethod = 'centroid';
        let defuzzifiedValue = 0;
        let historyValues = [];
        let inferenceInputs = { input1: 5, input2: 7 };
        let inferenceRules = [
            { id: 1, condition: 'low', operator: 'AND', condition2: 'medium', action: 'high', weight: 1.0 },
            { id: 2, condition: 'medium', operator: 'AND', condition2: 'high', action: 'medium', weight: 0.8 },
            { id: 3, condition: 'high', operator: 'AND', condition2: 'low', action: 'low', weight: 0.6 },
        ];
        let inferenceResult = { value: 0, steps: [] };

        // Tab switching logic
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function () {
                // Remove active state from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Set current tab and content as active
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');

                // Update charts based on current tab
                if (tabId === 'membership') {
                    updateMembershipChart();
                } else if (tabId === 'inference') {
                    updateInferenceChart();
                } else if (tabId === 'history') {
                    updateHistoryChart();
                }
            });
        });

        // Membership function calculation
        function calculateMembershipValue(x, params, type) {
            const { a, b, c, d } = params;

            switch (type) {
                case 'triangular':
                    if (x <= a || x >= c) return 0;
                    if (x <= b) return (x - a) / (b - a);
                    return (c - x) / (c - b);

                case 'trapezoidal':
                    if (x <= a || x >= d) return 0;
                    if (x >= b && x <= c) return 1;
                    if (x < b) return (x - a) / (b - a);
                    return (d - x) / (d - c);

                case 'gaussian':
                    const mean = b;
                    const sigma = (c - a) / 6; // Makes ±3σ cover from a to c
                    return Math.exp(-0.5 * Math.pow((x - mean) / sigma, 2));

                case 'sigmoid':
                    const k = 1;
                    return 1 / (1 + Math.exp(-k * (x - b)));

                case 'bell':
                    const bVal = (c - a) / 4;
                    return 1 / (1 + Math.pow(Math.abs((x - b) / bVal), 2 * d));

                default:
                    return 0;
            }
        }

        // Fuzzy logic operations
        const fuzzyOperations = {
            'AND': (a, b) => Math.min(a, b),
            'OR': (a, b) => Math.max(a, b),
            'NOT': (a) => 1 - a,
            'VERY': (a) => Math.pow(a, 2),
            'SOMEWHAT': (a) => Math.sqrt(a),
            'PLUS': (a, b) => Math.min(1, a + b),
            'MULT': (a, b) => a * b
        };

        // Defuzzification methods
        const defuzzificationMethods = {
            'centroid': (values) => {
                let sumProduct = 0;
                let sumValues = 0;
                values.forEach(point => {
                    sumProduct += point.x * point.y;
                    sumValues += point.y;
                });
                return sumValues === 0 ? 0 : sumProduct / sumValues;
            },
            'bisector': (values) => {
                const totalArea = values.reduce((sum, point) => sum + point.y, 0);
                let cumulativeSum = 0;
                for (let i = 0; i < values.length; i++) {
                    cumulativeSum += values[i].y;
                    if (cumulativeSum >= totalArea / 2) {
                        return values[i].x;
                    }
                }
                return 0;
            },
            'mean_of_maximum': (values) => {
                const maxValue = Math.max(...values.map(v => v.y));
                const maxXValues = values
                    .filter(v => v.y === maxValue)
                    .map(v => v.x);
                return maxXValues.length === 0 ? 0 : maxXValues.reduce((a, b) => a + b, 0) / maxXValues.length;
            },
            'first_of_maximum': (values) => {
                const maxValue = Math.max(...values.map(v => v.y));
                const maxPoint = values.find(v => v.y === maxValue);
                return maxPoint ? maxPoint.x : 0;
            },
            'last_of_maximum': (values) => {
                const maxValue = Math.max(...values.map(v => v.y));
                const maxPoints = values.filter(v => v.y === maxValue);
                return maxPoints.length > 0 ? maxPoints[maxPoints.length - 1].x : 0;
            }
        };

        // Calculate fuzzy operation results
        function calculateMembershipGraphData() {
            const data1 = [];
            const data2 = [];
            const resultData = [];

            for (let x = 0; x <= 10; x += 0.1) {
                const x1 = parseFloat(x.toFixed(1));
                const y1 = calculateMembershipValue(x1, fuzzySet1Params, selectedMembershipFunction);
                const y2 = calculateMembershipValue(x1, fuzzySet2Params, selectedMembershipFunction);

                let result;
                if (selectedOperation === 'NOT') {
                    result = fuzzyOperations[selectedOperation](y1);
                } else if (selectedOperation === 'VERY' || selectedOperation === 'SOMEWHAT') {
                    result = fuzzyOperations[selectedOperation](y1);
                } else {
                    result = fuzzyOperations[selectedOperation](y1, y2);
                }

                data1.push({ x: x1, y: y1 });
                data2.push({ x: x1, y: y2 });
                resultData.push({ x: x1, y: result });
            }

            return { data1, data2, resultData };
        }

        // Draw membership function chart
        function updateMembershipChart() {
            const { data1, data2, resultData } = calculateMembershipGraphData();
            const svg = d3.select('#membership-chart').html('').append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 600 300');

            const margin = { top: 20, right: 30, bottom: 40, left: 50 };
            const width = 600 - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Define scales
            const xScale = d3.scaleLinear()
                .domain([0, 10])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([0, 1])
                .range([height, 0]);

            // Draw axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale));

            g.append('g')
                .call(d3.axisLeft(yScale));

            // X-axis label
            g.append('text')
                .attr('x', width / 2)
                .attr('y', height + margin.bottom - 5)
                .attr('text-anchor', 'middle')
                .text('X Value');

            // Y-axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -margin.left + 15)
                .attr('text-anchor', 'middle')
                .text('Membership Degree (μ)');

            // Define line generator
            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y));

            // Draw set A line
            g.append('path')
                .datum(data1)
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary)')
                .attr('stroke-width', 2)
                .attr('d', line);

            // Draw set B line
            g.append('path')
                .datum(data2)
                .attr('fill', 'none')
                .attr('stroke', 'var(--secondary)')
                .attr('stroke-width', 2)
                .attr('d', line);

            // Draw result line
            g.append('path')
                .datum(resultData)
                .attr('fill', 'none')
                .attr('stroke', 'var(--tertiary)')
                .attr('stroke-width', 2)
                .attr('d', line);

            // Draw legend
            const legend = g.append('g')
                .attr('transform', `translate(${width - 120}, 10)`);

            legend.append('rect')
                .attr('width', 120)
                .attr('height', 70)
                .attr('fill', '#f5f5f5')
                .attr('opacity', 0.8)
                .attr('rx', 5);

            // Set A legend
            legend.append('line')
                .attr('x1', 10)
                .attr('y1', 15)
                .attr('x2', 30)
                .attr('y2', 15)
                .attr('stroke', 'var(--primary)')
                .attr('stroke-width', 2);

            legend.append('text')
                .attr('x', 35)
                .attr('y', 19)
                .attr('font-size', 12)
                .text('Set A');

            // Set B legend
            legend.append('line')
                .attr('x1', 10)
                .attr('y1', 35)
                .attr('x2', 30)
                .attr('y2', 35)
                .attr('stroke', 'var(--secondary)')
                .attr('stroke-width', 2);

            legend.append('text')
                .attr('x', 35)
                .attr('y', 39)
                .attr('font-size', 12)
                .text('Set B');

            // Result legend
            legend.append('line')
                .attr('x1', 10)
                .attr('y1', 55)
                .attr('x2', 30)
                .attr('y2', 55)
                .attr('stroke', 'var(--tertiary)')
                .attr('stroke-width', 2);

            legend.append('text')
                .attr('x', 35)
                .attr('y', 59)
                .attr('font-size', 12)
                .text(`${selectedOperation} Result`);

            // Draw input value vertical line
            const x = xScale(inputValue);
            const y1Value = calculateMembershipValue(inputValue, fuzzySet1Params, selectedMembershipFunction);
            const y2Value = calculateMembershipValue(inputValue, fuzzySet2Params, selectedMembershipFunction);

            let resultValue;
            if (selectedOperation === 'NOT') {
                resultValue = fuzzyOperations[selectedOperation](y1Value);
            } else if (selectedOperation === 'VERY' || selectedOperation === 'SOMEWHAT') {
                resultValue = fuzzyOperations[selectedOperation](y1Value);
            } else {
                resultValue = fuzzyOperations[selectedOperation](y1Value, y2Value);
            }

            // Input vertical line
            g.append('line')
                .attr('x1', x)
                .attr('y1', yScale(0))
                .attr('x2', x)
                .attr('y2', yScale(1))
                .attr('stroke', '#999')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4');

            // Points on each curve at input value
            g.append('circle')
                .attr('cx', x)
                .attr('cy', yScale(y1Value))
                .attr('r', 4)
                .attr('fill', 'var(--primary)');

            g.append('circle')
                .attr('cx', x)
                .attr('cy', yScale(y2Value))
                .attr('r', 4)
                .attr('fill', 'var(--secondary)');

            g.append('circle')
                .attr('cx', x)
                .attr('cy', yScale(resultValue))
                .attr('r', 4)
                .attr('fill', 'var(--tertiary)');

            // Display membership values
            g.append('text')
                .attr('x', x + 5)
                .attr('y', yScale(y1Value) - 5)
                .attr('font-size', 12)
                .attr('fill', 'var(--primary)')
                .text(`μA = ${y1Value.toFixed(2)}`);

            g.append('text')
                .attr('x', x + 5)
                .attr('y', yScale(y2Value) - 5)
                .attr('font-size', 12)
                .attr('fill', 'var(--secondary)')
                .text(`μB = ${y2Value.toFixed(2)}`);

            g.append('text')
                .attr('x', x + 5)
                .attr('y', yScale(resultValue) - 5)
                .attr('font-size', 12)
                .attr('fill', 'var(--tertiary)')
                .text(`μR = ${resultValue.toFixed(2)}`);

            // Update defuzzification result
            const defuzzifiedX = defuzzificationMethods[defuzzificationMethod](resultData);
            defuzzifiedValue = defuzzifiedX.toFixed(2);
            document.getElementById('defuzzified-value').textContent = defuzzifiedValue;

            // Draw defuzzification marker
            if (defuzzifiedValue !== 0 || Math.max(...resultData.map(d => d.y)) !== 0) {
                const defuzzX = xScale(defuzzifiedX);

                g.append('line')
                    .attr('x1', defuzzX)
                    .attr('y1', yScale(0))
                    .attr('x2', defuzzX)
                    .attr('y2', yScale(0.2))
                    .attr('stroke', 'var(--accent)')
                    .attr('stroke-width', 2);

                g.append('polygon')
                    .attr('points', `${defuzzX - 8},${yScale(0.2)} ${defuzzX},${yScale(0.35)} ${defuzzX + 8},${yScale(0.2)}`)
                    .attr('fill', 'var(--accent)');

                g.append('text')
                    .attr('x', defuzzX)
                    .attr('y', yScale(0.4))
                    .attr('font-size', 12)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'var(--accent)')
                    .text(defuzzifiedValue);
            }

            // Update history data
            historyValues.push({
                time: new Date().toLocaleTimeString(),
                value: defuzzifiedValue,
                operation: selectedOperation,
                defuzzMethod: defuzzificationMethod
            });

            if (historyValues.length > 20) {
                historyValues.shift();
            }

            updateHistoryTable();
        }

        // Update history table
        function updateHistoryTable() {
            const tbody = document.getElementById('history-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';
            historyValues.forEach((entry, index) => {
                const row = document.createElement('tr');

                const timeCell = document.createElement('td');
                timeCell.textContent = entry.time;

                const valueCell = document.createElement('td');
                valueCell.textContent = entry.value.toFixed(2);

                const operationCell = document.createElement('td');
                operationCell.textContent = entry.operation;

                const methodCell = document.createElement('td');
                methodCell.textContent = entry.defuzzMethod;

                row.appendChild(timeCell);
                row.appendChild(valueCell);
                row.appendChild(operationCell);
                row.appendChild(methodCell);

                tbody.appendChild(row);
            });
        }

        // Fuzzy inference system logic
        function fuzzyInference() {
            const { input1, input2 } = inferenceInputs;

            // Define linguistic variable membership functions
            const membershipFunctions = {
                input1: {
                    low: { type: 'triangular', params: { a: 0, b: 2, c: 4, d: 0 } },
                    medium: { type: 'triangular', params: { a: 3, b: 5, c: 7, d: 0 } },
                    high: { type: 'triangular', params: { a: 6, b: 8, c: 10, d: 0 } }
                },
                input2: {
                    low: { type: 'triangular', params: { a: 0, b: 2, c: 4, d: 0 } },
                    medium: { type: 'triangular', params: { a: 3, b: 5, c: 7, d: 0 } },
                    high: { type: 'triangular', params: { a: 6, b: 8, c: 10, d: 0 } }
                },
                output: {
                    low: { type: 'triangular', params: { a: 0, b: 2, c: 4, d: 0 } },
                    medium: { type: 'triangular', params: { a: 3, b: 5, c: 7, d: 0 } },
                    high: { type: 'triangular', params: { a: 6, b: 8, c: 10, d: 0 } }
                }
            };

            // Fuzzify inputs
            const fuzzifiedInputs = {
                input1: {
                    low: calculateMembershipValue(input1, membershipFunctions.input1.low.params, 'triangular'),
                    medium: calculateMembershipValue(input1, membershipFunctions.input1.medium.params, 'triangular'),
                    high: calculateMembershipValue(input1, membershipFunctions.input1.high.params, 'triangular')
                },
                input2: {
                    low: calculateMembershipValue(input2, membershipFunctions.input2.low.params, 'triangular'),
                    medium: calculateMembershipValue(input2, membershipFunctions.input2.medium.params, 'triangular'),
                    high: calculateMembershipValue(input2, membershipFunctions.input2.high.params, 'triangular')
                }
            };

            // Update fuzzification display
            document.getElementById('input1-fuzzification').innerHTML = `
        <li>Low: ${fuzzifiedInputs.input1.low.toFixed(2)}</li>
        <li>Medium: ${fuzzifiedInputs.input1.medium.toFixed(2)}</li>
        <li>High: ${fuzzifiedInputs.input1.high.toFixed(2)}</li>
      `;

            document.getElementById('input2-fuzzification').innerHTML = `
        <li>Low: ${fuzzifiedInputs.input2.low.toFixed(2)}</li>
        <li>Medium: ${fuzzifiedInputs.input2.medium.toFixed(2)}</li>
        <li>High: ${fuzzifiedInputs.input2.high.toFixed(2)}</li>
      `;

            // Apply fuzzy rules
            const ruleResults = inferenceRules.map((rule, index) => {
                const inputVal1 = fuzzifiedInputs.input1[rule.condition];
                const inputVal2 = fuzzifiedInputs.input2[rule.condition2];

                let firingStrength;
                switch (rule.operator) {
                    case 'AND':
                        firingStrength = Math.min(inputVal1, inputVal2);
                        break;
                    case 'OR':
                        firingStrength = Math.max(inputVal1, inputVal2);
                        break;
                    default:
                        firingStrength = Math.min(inputVal1, inputVal2);
                }

                // Apply weight
                firingStrength *= rule.weight;

                return {
                    rule: `${rule.id}. IF input1 is ${rule.condition} ${rule.operator} input2 is ${rule.condition2} THEN output is ${rule.action}`,
                    firingStrength,
                    outputSet: rule.action,
                    input1Value: inputVal1,
                    input2Value: inputVal2
                };
            });

            // Aggregate all rule outputs
            const aggregatedOutput = [];
            for (let x = 0; x <= 10; x += 0.1) {
                const x1 = parseFloat(x.toFixed(1));

                // For each x, find maximum truncated value across all rules
                let maxVal = 0;
                ruleResults.forEach(result => {
                    const outputFn = membershipFunctions.output[result.outputSet];
                    const outputVal = calculateMembershipValue(x1, outputFn.params, 'triangular');
                    const truncatedVal = Math.min(outputVal, result.firingStrength);
                    maxVal = Math.max(maxVal, truncatedVal);
                });

                aggregatedOutput.push({ x: x1, y: maxVal });
            }

            // Defuzzification (using centroid method)
            const numerator = aggregatedOutput.reduce((sum, point) => sum + point.x * point.y, 0);
            const denominator = aggregatedOutput.reduce((sum, point) => sum + point.y, 0);
            const crispOutput = denominator === 0 ? 0 : numerator / denominator;

            // Update inference result
            inferenceResult = {
                value: parseFloat(crispOutput.toFixed(2)),
                steps: ruleResults,
                aggregatedOutput
            };

            document.getElementById('inference-result').textContent = inferenceResult.value.toFixed(2);

            // Update rule firing strengths display
            const ruleStrengthsContainer = document.getElementById('rule-firing-strengths');
            ruleStrengthsContainer.innerHTML = '';

            inferenceResult.steps.forEach((step, index) => {
                const listItem = document.createElement('li');
                listItem.style.display = 'flex';
                listItem.style.justifyContent = 'space-between';
                listItem.style.alignItems = 'center';
                listItem.style.marginBottom = index < inferenceResult.steps.length - 1 ? '5px' : '0';

                const label = document.createElement('span');
                label.textContent = `Rule ${index + 1}:`;

                const progressContainer = document.createElement('div');
                progressContainer.style.width = '120px';
                progressContainer.style.margin = '0 5px';

                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';

                const progressFill = document.createElement('div');
                progressFill.className = 'progress-fill';
                progressFill.style.width = `${step.firingStrength * 100}%`;

                const value = document.createElement('span');
                value.textContent = step.firingStrength.toFixed(2);

                progressBar.appendChild(progressFill);
                progressContainer.appendChild(progressBar);

                listItem.appendChild(label);
                listItem.appendChild(progressContainer);
                listItem.appendChild(value);

                ruleStrengthsContainer.appendChild(listItem);
            });
        }

        // Update fuzzy inference chart
        function updateInferenceChart() {
            // If no aggregated output data, run fuzzy inference first
            if (!inferenceResult.aggregatedOutput) {
                fuzzyInference();
            }

            const aggregatedOutput = inferenceResult.aggregatedOutput;

            const svg = d3.select('#inference-chart').html('').append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 600 300');

            const margin = { top: 20, right: 30, bottom: 40, left: 50 };
            const width = 600 - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Define scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(aggregatedOutput, d => d.x))
                .range([0, width])

            const yScale = d3.scaleLinear()
                .domain([0, 1])
                .range([height, 0]);

            // Draw axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale));

            g.append('g')
                .call(d3.axisLeft(yScale));

            // X-axis label
            g.append('text')
                .attr('x', width / 2)
                .attr('y', height + margin.bottom - 5)
                .attr('text-anchor', 'middle')
                .text('Output Value');

            // Y-axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -margin.left + 15)
                .attr('text-anchor', 'middle')
                .text('Membership Degree (μ)');

            // Define area generator
            const area = d3.area()
                .x(d => xScale(d.x))
                .y0(yScale(0))
                .y1(d => yScale(d.y));

            // Draw aggregated output area
            g.append('path')
                .datum(aggregatedOutput)
                .attr('fill', 'var(--tertiary)')
                .attr('fill-opacity', 0.3)
                .attr('stroke', 'var(--tertiary)')
                .attr('stroke-width', 1)
                .attr('d', area);

            // Draw defuzzification marker
            const defuzzX = xScale(inferenceResult.value);

            g.append('line')
                .attr('x1', defuzzX)
                .attr('y1', yScale(0))
                .attr('x2', defuzzX)
                .attr('y2', yScale(0.2))
                .attr('stroke', 'var(--accent)')
                .attr('stroke-width', 2);

            g.append('polygon')
                .attr('points', `${defuzzX - 8},${yScale(0.2)} ${defuzzX},${yScale(0.35)} ${defuzzX + 8},${yScale(0.2)}`)
                .attr('fill', 'var(--accent)');

            g.append('text')
                .attr('x', defuzzX)
                .attr('y', yScale(0.4))
                .attr('font-size', 12)
                .attr('text-anchor', 'middle')
                .attr('fill', 'var(--accent)')
                .text(inferenceResult.value);
        }

        // Draw history trend chart
        function updateHistoryChart() {
            if (historyValues.length < 2) {
                document.getElementById('history-chart').innerHTML = '<div style="text-align: center; padding: 100px 0;">More data points needed...</div>';
                return;
            }

            const svg = d3.select('#history-chart').html('').append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 600 300');

            const margin = { top: 20, right: 30, bottom: 40, left: 50 };
            const width = 600 - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Define scales - using linear scale with indices for simplicity
            const xScale = d3.scaleLinear()
                .domain([0, historyValues.length - 1])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([0, d3.max(historyValues, d => parseFloat(d.value)) * 1.1 || 10])
                .range([height, 0]);

            // Draw axes
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale)
                    .ticks(Math.min(historyValues.length, 10))
                    .tickFormat(i => {
                        const index = Math.round(i);
                        return index >= 0 && index < historyValues.length ?
                            (index + 1) : '';
                    }));

            g.append('g')
                .call(d3.axisLeft(yScale));

            // X-axis label
            g.append('text')
                .attr('x', width / 2)
                .attr('y', height + margin.bottom - 5)
                .attr('text-anchor', 'middle')
                .text('Time Series');

            // Y-axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', -margin.left + 15)
                .attr('text-anchor', 'middle')
                .text('Defuzzified Value');

            // Define line generator
            const line = d3.line()
                .x((d, i) => xScale(i))
                .y(d => yScale(parseFloat(d.value)));

            // Draw trend line
            g.append('path')
                .datum(historyValues)
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary)')
                .attr('stroke-width', 2)
                .attr('d', line);

            // Draw data points
            g.selectAll('.data-point')
                .data(historyValues)
                .enter()
                .append('circle')
                .attr('cx', (d, i) => xScale(i))
                .attr('cy', d => yScale(parseFloat(d.value)))
                .attr('r', 4)
                .attr('fill', 'var(--primary)');
        }

        // Page load initialization
        document.addEventListener('DOMContentLoaded', function () {
            // Membership function change logic
            document.getElementById('membership-function').addEventListener('change', function () {
                selectedMembershipFunction = this.value;

                // Show or hide parameter d
                if (this.value === 'trapezoidal' || this.value === 'bell') {
                    document.getElementById('set1-d-container').style.display = 'block';
                    document.getElementById('set2-d-container').style.display = 'block';
                } else {
                    document.getElementById('set1-d-container').style.display = 'none';
                    document.getElementById('set2-d-container').style.display = 'none';
                }

                updateMembershipChart();
            });

            // Set A parameter change handlers
            document.getElementById('set1-a').addEventListener('input', function () {
                fuzzySet1Params.a = parseFloat(this.value);
                document.getElementById('set1-a-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set1-b').addEventListener('input', function () {
                fuzzySet1Params.b = parseFloat(this.value);
                document.getElementById('set1-b-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set1-c').addEventListener('input', function () {
                fuzzySet1Params.c = parseFloat(this.value);
                document.getElementById('set1-c-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set1-d').addEventListener('input', function () {
                fuzzySet1Params.d = parseFloat(this.value);
                document.getElementById('set1-d-value').textContent = this.value;
                updateMembershipChart();
            });

            // Set B parameter change handlers
            document.getElementById('set2-a').addEventListener('input', function () {
                fuzzySet2Params.a = parseFloat(this.value);
                document.getElementById('set2-a-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set2-b').addEventListener('input', function () {
                fuzzySet2Params.b = parseFloat(this.value);
                document.getElementById('set2-b-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set2-c').addEventListener('input', function () {
                fuzzySet2Params.c = parseFloat(this.value);
                document.getElementById('set2-c-value').textContent = this.value;
                updateMembershipChart();
            });

            document.getElementById('set2-d').addEventListener('input', function () {
                fuzzySet2Params.d = parseFloat(this.value);
                document.getElementById('set2-d-value').textContent = this.value;
                updateMembershipChart();
            });

            // Fuzzy operation type change
            document.getElementById('operation').addEventListener('change', function () {
                selectedOperation = this.value;
                updateMembershipChart();
            });

            // Input value change
            document.getElementById('input-value').addEventListener('input', function () {
                inputValue = parseFloat(this.value);
                document.getElementById('input-value-display').textContent = this.value;
                updateMembershipChart();
            });

            // Defuzzification method change
            document.getElementById('defuzzification').addEventListener('change', function () {
                defuzzificationMethod = this.value;
                updateMembershipChart();
            });

            // Inference system input changes
            document.getElementById('inference-input1').addEventListener('input', function () {
                inferenceInputs.input1 = parseFloat(this.value);
                document.getElementById('inference-input1-value').textContent = this.value;
                fuzzyInference();
                updateInferenceChart();
            });

            document.getElementById('inference-input2').addEventListener('input', function () {
                inferenceInputs.input2 = parseFloat(this.value);
                document.getElementById('inference-input2-value').textContent = this.value;
                fuzzyInference();
                updateInferenceChart();
            });

            // Rule weight changes
            document.querySelectorAll('.rule-weight').forEach((weightInput, index) => {
                weightInput.addEventListener('input', function () {
                    inferenceRules[index].weight = parseFloat(this.value);
                    document.querySelectorAll('.rule-weight-value')[index].textContent = this.value;
                    fuzzyInference();
                    updateInferenceChart();
                });
            });

            // Add rule button
            document.getElementById('add-rule').addEventListener('click', function () {
                const ruleIndex = inferenceRules.length;

                const newRule = {
                    id: ruleIndex + 1,
                    condition: 'low',
                    operator: 'AND',
                    condition2: 'low',
                    action: 'low',
                    weight: 1.0
                };

                inferenceRules.push(newRule);

                const ruleCard = document.createElement('div');
                ruleCard.className = 'rule-card';
                ruleCard.innerHTML = `
        <div class="rule-header">
            <div>
                <span class="badge badge-blue">Rule ${newRule.id}</span>
                IF
                <select class="rule-condition" data-index="${ruleIndex}">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
                AND
                <select class="rule-condition2" data-index="${ruleIndex}">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
                THEN output is
                <select class="rule-output" data-index="${ruleIndex}">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div>
                <input type="range" min="0" max="1" step="0.1" value="1.0" class="rule-weight" data-index="${ruleIndex}" style="width: 60px;">
                <span class="rule-weight-value">1.0</span>
            </div>
        </div>
    `;

                document.getElementById('rules-container').appendChild(ruleCard);

                attachSingleRuleEventListeners(ruleCard, ruleIndex);

                fuzzyInference();
                updateInferenceChart();
            });

            function attachSingleRuleEventListeners(ruleElement, index) {
                ruleElement.querySelector('.rule-condition').addEventListener('change', function () {
                    inferenceRules[index].condition = this.value;
                    fuzzyInference();
                    updateInferenceChart();
                });

                ruleElement.querySelector('.rule-condition2').addEventListener('change', function () {
                    inferenceRules[index].condition2 = this.value;
                    fuzzyInference();
                    updateInferenceChart();
                });

                ruleElement.querySelector('.rule-output').addEventListener('change', function () {
                    inferenceRules[index].action = this.value;
                    fuzzyInference();
                    updateInferenceChart();
                });

                ruleElement.querySelector('.rule-weight').addEventListener('input', function () {
                    inferenceRules[index].weight = parseFloat(this.value);
                    ruleElement.querySelector('.rule-weight-value').textContent = this.value;
                    fuzzyInference();
                    updateInferenceChart();
                });
            }

            function attachRuleEventListeners() {
                document.querySelectorAll('.rule-card').forEach((ruleCard, index) => {
                    attachSingleRuleEventListeners(ruleCard, index);
                });
            }

            // Run once to ensure existing rules are correctly initialized
            attachRuleEventListeners();

            // Initialize charts
            updateMembershipChart();
            fuzzyInference();
            updateInferenceChart();
            updateHistoryChart();
        });
    </script>
</body>

</html>